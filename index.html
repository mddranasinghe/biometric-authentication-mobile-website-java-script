<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAuthn Demo</title>
</head>
<body>
    <h1>WebAuthn Demo</h1>

    <h2>Registration</h2>
    <button id="registerButton">Register Credentials</button>

    <h2>Authentication</h2>
    <button id="authenticateButton">Authenticate</button>

    <div id="idd">gggggggggggg </div>
    <br><br>
    <div id="idd2">gggggggggggg </div>

    <script>
        // Function to handle registration and storage of WebAuthn credentials
        async function registerAndStoreCredentials() {
            try {
                // Generate PublicKeyCredentialCreationOptions for registration
                const publicKeyCredentialCreationOptions = {
                    challenge: new Uint8Array(32),
                    rp: { name: 'WebAuthn Demo' },
                    user: { id: new Uint8Array(16), name: 'user@example.com', displayName: 'User' },
                    pubKeyCredParams: [{ type: 'public-key', alg: -7 }],
                    timeout: 60000
                };

                // Register credentials with WebAuthn
                const credential = await navigator.credentials.create({
                    publicKey: publicKeyCredentialCreationOptions
                });

                // Store the credential in localStorage
                localStorage.setItem('webauthnCredential', JSON.stringify(credential));

                console.log('Credential stored successfully:', credential);
                document.getElementById('idd').innerHTML = `
                    <p>User ID: ${credential.user.id}</p>
                    <p>User Name: ${credential.user.name}</p>
                    <p>Display Name: ${credential.user.displayName}</p>
                `;

            } catch (error) {
                console.error('Error storing credential:', error);
                document.getElementById('idd').innerHTML = 'Error';
            }
        }

        // Function to handle authentication using WebAuthn credentials
        async function authenticate() {
            try {
                // Retrieve the stored credential from localStorage
                const storedCredential = JSON.parse(localStorage.getItem('webauthnCredential'));
                document.getElementById('idd2').innerHTML = `
                    <p>User ID: ${storedCredential.user.id}</p>
                    <p>User Name: ${storedCredential.user.name}</p>
                    <p>Display Name: ${storedCredential.user.displayName}</p>
                `;
                if (!storedCredential) {
                    console.error('No stored credential found.');
                    return;
                }

                // Generate a random challenge
                const challenge = new Uint8Array(32);

                // Create PublicKeyCredentialRequestOptions
                const publicKeyCredentialRequestOptions = {
                    challenge: challenge,
                    userVerification: 'required'
                };

                // Get credentials for authentication
                const credential = await navigator.credentials.get({
                    publicKey: publicKeyCredentialRequestOptions
                });

                console.log('Credential authenticated:', credential);
            } catch (error) {
                console.error('Error during WebAuthn authentication:', error);
            }
        }

        // Add event listeners to buttons
        document.getElementById('registerButton').addEventListener('click', registerAndStoreCredentials);
        document.getElementById('authenticateButton').addEventListener('click', authenticate);
    </script>
</body>
</html>
